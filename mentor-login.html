<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mentor Login | SOS</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body>
  <header class="app-header">
        <div class="header-left">
            <span class="logo-icon">ðŸš¦</span>
            <span class="logo-text">SOS: <strong>Mentor Connect</strong></span>
        </div>
        <div class="header-right">
            <span class="hackathon-badge">Built for Hackathons ðŸš€</span>
        </div>
    </header>

    <main class="hero-container">
        <div class="hero-card login-card">
            
            <div class="profile-icon-container">
                <div class="profile-icon"></div>
            </div>
            
            <h1>Mentor Login</h1>
            <p class="hero-description">
                Enter the code provided by your instructor to log in.
            </p>

            <div class="login-form">
                <div class="input-group">
                    <input type="password" id="codeInput" placeholder="Enter Code">
                    <button class="btn-submit" id="loginBtn">Login</button>
                </div>
                <p id="errorMessage" class="error-text hidden"></p>
            </div>
        </div>
    </main>

    <script type="module">
    import { db } from "./js/firebase.js";
    import { ref, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const errorDisplay = document.getElementById("errorMessage");

    // --- 1. Reusable login function with UI error handling ---
    async function handleLogin() {
        const enteredCode = document.getElementById("codeInput").value.trim();
        
        // Reset UI
        errorDisplay.classList.add("hidden");
        errorDisplay.textContent = "";

        if (!enteredCode) {
            showError("Please enter a code.");
            return;
        }

        try {
            const snapshot = await get(ref(db, "tinkherhack/accessCodes/mentorCode"));

            if (snapshot.exists()) {
                const correctCode = snapshot.val();

                if (enteredCode === correctCode) {
                    localStorage.setItem("userType", "mentor");
                    window.location.href = "mentor.html";
                } else {
                    showError("Invalid Code. Please try again.");
                }
            } else {
                showError("Code not found in database.");
            }
        } catch (error) {
            console.error("Firebase Error:", error);
            showError("ðŸ“¡ Connection error. Please check your internet.");
        }
    }

    // Helper to display error
    function showError(message) {
        errorDisplay.textContent = message;
        errorDisplay.classList.remove("hidden");
    }

    // --- 2. Listen for the Button Click ---
    document.getElementById("loginBtn").addEventListener("click", handleLogin);

    // --- 3. Listen for the 'Enter' Key ---
    document.getElementById("codeInput").addEventListener("keypress", function (e) {
        if (e.key === 'Enter') {
            handleLogin();
        }
    });
</script>

</body>
</html>